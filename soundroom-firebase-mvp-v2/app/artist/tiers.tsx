
import { useEffect, useState } from 'react'; import { useLocalSearchParams } from 'expo-router'; import { ScrollView, Text, View, Pressable, Alert } from 'react-native'; import { theme } from '@/lib/theme'; import { auth, db } from '@/lib/firebase'; import { collection, doc, getDocs, setDoc } from 'firebase/firestore'; import seed from '@/data/seed.json';
export default function Tiers(){ const {handle}=useLocalSearchParams(); const [tiers,setTiers]=useState<any[]>([]); const artistSeed=seed.artists.find(a=>a.handle===handle)||seed.artists[0];
useEffect(()=>{(async()=>{ try{const snap=await getDocs(collection(db,'artists',String(handle),'tiers')); const list=snap.docs.map(d=>({id:d.id,...d.data()})); setTiers(list.length? list: artistSeed.tiers);}catch{ setTiers(artistSeed.tiers);} })();},[handle]);
const subscribe=async(tierId:string)=>{ if(!auth.currentUser){Alert.alert('Sign in required','Please sign in first.'); return;} const subId=`${auth.currentUser.uid}_${handle}`; await setDoc(doc(db,'subscriptions',subId),{uid:auth.currentUser.uid,handle,tierId,active:true,createdAt:Date.now()}); Alert.alert('Subscribed','Subscription marked active (test).'); };
return (<ScrollView style={{backgroundColor:theme.bg,padding:16}}><Text style={{color:theme.text,fontSize:24,fontWeight:'800',marginBottom:8}}>Membership</Text>
{tiers.map(t=>(<View key={t.id} style={{backgroundColor:theme.card,borderRadius:12,padding:12,marginBottom:12}}><Text style={{color:theme.text,fontSize:18,fontWeight:'700'}}>{t.name} — ${t.price}/mo</Text>{t.perks?.map((p:string,i:number)=><Text key={i} style={{color:theme.subtext}}>• {p}</Text>)}<Pressable onPress={()=>subscribe(t.id)}><Text style={{color:theme.neon,marginTop:8}}>Subscribe (test)</Text></Pressable></View>))}</ScrollView>); }
